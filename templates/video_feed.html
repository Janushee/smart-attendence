{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg p-4">
        <div class="text-center">
            <h1 class="display-4 text-primary">Live Video Feed</h1>
            <p class="lead text-secondary mt-3">
                Here you can see the live video feed along with face recognition.
            </p>
            <hr class="my-4">
            <p class="text-muted">The system will mark attendance when a person is recognized.</p>
        </div>

        <!-- Video Feed -->
        <div class="row mt-5">
            <div class="col-md-12 text-center">
                <h4>Video Stream</h4>
                <img src="{{ url_for('video_feed') }}" alt="Live Feed" width="100%" height="auto">
            </div>
        </div>

        <!-- Attendance Alert -->
        <div id="attendanceAlert" class="alert alert-success mt-3" style="display:none;">
            <strong>Attendance Marked!</strong> The attendance for <span id="attendeeName"></span> was recorded at <span id="attendeeTime"></span>.
        </div>

        <div class="row mt-5">
            <div class="col-md-12 text-center">
                <a href="{{ url_for('view_attendance') }}" class="btn btn-outline-info btn-lg">
                    View Attendance Records
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<script>
    const socket = io();

    // Listen for the attendance capture event
    socket.on('attendance_captured_live', function(data) {
        const attendanceAlert = document.getElementById('attendanceAlert');
        const attendeeName = document.getElementById('attendeeName');
        const attendeeTime = document.getElementById('attendeeTime');
        console.log("Received data:", data);

        attendeeName.innerText = data.name;
        attendeeTime.innerText = data.timestamp;

        attendanceAlert.style.display = 'block'; // Show the alert

        setTimeout(() => {
            attendanceAlert.style.display = 'none'; // Hide the alert after 5 seconds
        }, 5000);
    });
</script>

{% endblock %}
